{% extends 'base.html' %}
{% block content %}
    <div id="saveAlert" class="alert" style="display: none;" role="alert"></div>

    <div>
        <form id="settingsForm">
            <div class="mb-3">
                <label for="inputAudiobookshelfUrl" class="form-label">Audiobookshelf URL</label>
                <input type="text" class="form-control" id="inputAudiobookshelfUrl" name="abs_url" value="{{ settings.abs_url }}" aria-describedby="absUrlHelp">
                <div id="absUrlHelp" class="form-text">https://abs.example.com</div>
            </div>

            <div class="mb-3">
                <label for="inputAudiobookshelfApiKey" class="form-label">Audiobookshelf API Key</label>
                <input type="text" class="form-control" id="inputAudiobookshelfApiKey" name="abs_api_key" value="{{ settings.abs_api_key }}" aria-describedby="absApiKeyHelp">
                <div id="absApiKeyHelp" class="form-text">Bearer uhf8hry98ydfyaw8e9fy...</div>
            </div>

            <div class="mb-3">
                <label for="inputAudiobookshelfLibraryId" class="form-label">Audiobookshelf Library ID</label>
                <input type="text" class="form-control" id="inputAudiobookshelfLibraryId" name="abs_library_id" value="{{ settings.abs_library_id }}" aria-describedby="absLibraryIdHelp">
                <div id="absLibraryIdHelp" class="form-text">0a0c4b05-e4bd-486d-85fd-3c053082b540</div>
            </div>



            <button type="submit" class="btn btn-primary">Save</button>
            <script>
            document.getElementById('settingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                fetch('/api/settings/save/', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    const alertDiv = document.getElementById('saveAlert');
                    alertDiv.className = 'alert alert-success';
                    alertDiv.textContent = data.message;
                    alertDiv.style.display = 'block';
                    setTimeout(() => alertDiv.style.display = 'none', 5000);
                })
                .catch(error => {
                    const alertDiv = document.getElementById('saveAlert');
                    alertDiv.className = 'alert alert-danger';
                    alertDiv.textContent = 'Error saving settings';
                    alertDiv.style.display = 'block';
                    setTimeout(() => alertDiv.style.display = 'none', 5000);
                });
            });
            </script>
        </form>
    </div>
{% endblock %}
